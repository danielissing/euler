# Overview

**Problem link:** [Project Euler Problem 938](https://projecteuler.net/problem=938)

Explanations below follow the solution generated by ChatGPT (`solution_chat.py`). For this particular problem, Gemini also produced working code that delivers the correct response (even though it's slower).

## 1. Problem Statement

We start with a deck containing $R$ red cards and $B$ black cards. In each step, draw two cards uniformly without replacement, then carry out the following operations:
- **RR**: discard both reds
- **BB**: put both blacks back (state unchanged)
- **RB**: put the red back, discard the black

Play stops when all remaining cards are the same color. Let $P(R,B)$ be the probability the final color is **black**. 

**Task:** Compute $P(24690,12345)$.

## 2. High-Level Solution Idea

- Note that BB events can be ignored since they don't change anything, and also that $P(R,B)$ is 0 if $R$ is odd.
- RR events get us closer to a "win" for black, RB events closer to a "win" for red. So we can think of these two events as a race with weights that depend on the current state $(r,b)$ of the deck.
- We can then use two independent "exponential clocks" based on those weights, and use these timers $S_R$ and $S_B$ to calculate the desired probability $P(R,B) = \Pr(S_R < S_B)$
- This probability can be expressed in closed form by using a recurrence relation for the $S_i$'s to derive a differential equation.

## 3. The Math Behind the Solution

### (a) Exponential clocks

For a **state-changing** events at state $(r,b)$, the probabilities for RR and RB are:

$$\Pr(\mathrm{RR})=\frac{\binom{r}{2}}{\binom{r}{2}+rb} = \frac{r-1}{(r-1)+2b}, \qquad \Pr(\mathrm{RB})=\frac{rb}{\binom{r}{2}+rb} = \frac{2b}{(r-1)+2b}$$

We can think of the game as a race between "RR" and "RB" with weights $(r-1):(2b)$ (denominator is the same). Consider even $R=2x$. The process ends when either:
- $x$ RR events have occurred (all reds gone ⇒ black wins), or
- $B$ RB events have occurred (all blacks gone ⇒ red wins)

Embed the process in continuous time with independent exponential clocks so that:

$$S_R = \sum_{i=1}^{x}\exp(2i-1), \qquad S_B = \sum_{j=1}^{B}\exp(2j) $$

### (b) ODE solution

Define a generating function $G_b(t) = \Pr(S_B > t)$. Using $S_B = S_{b-1} + e^{2b}$ and independence leads to the renewal ODE:

$$G_b'(t) = -2b \cdot G_b(t) + 2b \cdot G_{b-1}(t), \quad G_b(0)=1, \quad G_0 \equiv 0$$

whose solution is:

$$G_b(t) = 1 - (1 - e^{-2t})^b \quad (t \ge 0)$$

Hence:

$$P(2x,b) = \int_0^{\infty} f_{S_R}(t) \cdot G_b(t) \, dt = 1 - \mathbb{E}\left[(1 - e^{-2S_R})^b\right]$$

### (c) Enter Beta functions

Set $U = e^{-2S_R}$, then (for $c > 0$), $\mathbb{E}[e^{-kcZ}] = \frac{1}{1+k/c}$. Setting $e^{\lambda} = Z/\lambda$, we find:

$$\mathbb{E}[U^k] = \prod_{i=1}^{x}\frac{2i-1}{2i-1+2k} = \frac{\Gamma(x+\frac{1}{2})\Gamma(k+\frac{1}{2})}{\Gamma(\frac{1}{2})\Gamma(x+k+\frac{1}{2})} = \frac{B(k+\frac{1}{2}, x)}{B(\frac{1}{2}, x)}$$

These are exactly the moments of $B(\frac{1}{2}, x)$ on $(0,1)$, so:

$$U \overset{d}{=} B\left(\frac{1}{2}, x\right)$$

With $U \sim B(\frac{1}{2}, x)$:

$$\mathbb{E}[(1-U)^b] = \frac{B(\frac{1}{2}, x+b)}{B(\frac{1}{2}, x)}$$

Therefore:

$$\boxed{P(2x,b) = 1 - \frac{B(\frac{1}{2}, x+b)}{B(\frac{1}{2}, x)} = 1 - \frac{\Gamma(x+b)}{\Gamma(x+b+\frac{1}{2})} \cdot \frac{\Gamma(x+\frac{1}{2})}{\Gamma(x)}}$$


## 4. Techniques Used to Increase Algorithmic Efficiency

Not really needed since we found a closed form $O(1)$ expression for $P(R,B)$. Code uses log-Gamma evaluation for numerical stability.
